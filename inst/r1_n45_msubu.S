#include <asm.h>
#include <regdef.h>

#define TEST_MSUBU(in_a, in_b, in_c, in_d, ref_lo, ref_hi) \
    li t0, in_a; \
    li t1, in_b; \
    li a0, in_c; \
    li a1, in_d; \
    multu t0, t1; \
    msubu a0, a1; \
    mflo v1; \
    li v0, ref_lo; \
    bne v0, v1, inst_error; \
    nop; \
    mfhi v1; \
    li v0, ref_hi; \
    bne v0, v1, inst_error; \
    nop

LEAF(msubu_test)
    .set noreorder
    addiu s0, s0, 1
###test inst
    TEST_MSUBU(0x08cb172c, 0x3ce9a88b, 0x010d3999, 0xfa44b33a, 0x419d6d3a, 0x01106d91)
    TEST_MSUBU(0x28ab1bb0, 0x18058494, 0xf68ffd07, 0x957edd69, 0xbcb2eee1, 0x73d4ec9c)
    TEST_MSUBU(0xfb991930, 0x0d187858, 0x15dc4040, 0x96248000, 0x63cf2880, 0x000ca75b)
    TEST_MSUBU(0x0ae23b9d, 0xcb0037e3, 0x4f12cab3, 0xae474ad6, 0x56776795, 0xd2cc9c8c)
    TEST_MSUBU(0x4ad2cfb6, 0x62a08b2d, 0xa524073d, 0x3568e1c4, 0x6fdc2d4a, 0xfa5f822d)
    TEST_MSUBU(0xc53c3539, 0x0c44d64f, 0x05951d7f, 0x151e082f, 0x7207b046, 0x08fdf887)
    TEST_MSUBU(0x349a4804, 0x344859da, 0xc86720b8, 0x739959e7, 0x9a243960, 0xb03fd4c5)
    TEST_MSUBU(0x60e83a87, 0x347d5352, 0x41f7528b, 0x967b13a2, 0x20dbf748, 0xed17fb91)
    TEST_MSUBU(0xe18d5ff6, 0x81751ccf, 0x0794e61a, 0xd2bdff22, 0x21110a76, 0x6bd1a71c)
    TEST_MSUBU(0xb857474a, 0xdb90b7a7, 0xd2f8f546, 0x36b4b481, 0x77649700, 0x71056fc8)
    TEST_MSUBU(0x34b704be, 0x6dbff895, 0xfca2ac8b, 0x8abe827d, 0x76a8fcb7, 0x8dadc23c)
    TEST_MSUBU(0x356945bc, 0x8b48b1ef, 0x0045ffb5, 0x92d60944, 0xd37bcd70, 0x1ce72d3c)
    TEST_MSUBU(0xeea2d177, 0x56323bca, 0x2bc18361, 0x739f6e3c, 0x21f03c2a, 0x3c9657da)
    TEST_MSUBU(0x368f2969, 0x59852829, 0xe58e3ff4, 0x7d37ad2e, 0xddbfa7f9, 0xa2cbc440)
    TEST_MSUBU(0xb855be85, 0xc601cc12, 0xe5df6988, 0xc7f4eb73, 0x3f822142, 0xdb07053d)
    TEST_MSUBU(0x9af75f1a, 0x672afec7, 0xb33e6ba4, 0xc119033e, 0xab85bb7e, 0xb73ffb8e)
    TEST_MSUBU(0x9df55306, 0xe3d3042d, 0x91086db0, 0x75bcf74f, 0x78af06be, 0x49ded3f7)
    TEST_MSUBU(0x317cddfd, 0x9d26bb33, 0x9e380e47, 0x737393ff, 0x15a80aae, 0xd70673cd)
    TEST_MSUBU(0x9f77c48c, 0xfa7a9338, 0xbb0de848, 0x311aef8e, 0xede552b0, 0x7825f8cf)
    TEST_MSUBU(0x0c51b2f9, 0x48571bb6, 0xbb59ad6b, 0x99f01712, 0x7861b180, 0x92d2ddd5)
    TEST_MSUBU(0x4067d047, 0xcb28c529, 0x4279f2cd, 0x16769ab8, 0x5fcb2907, 0x2d474cba)
    TEST_MSUBU(0x4833e448, 0x8077218b, 0x5aaec92d, 0xdfe4bad7, 0x7c08944d, 0xd4ec44a0)
    TEST_MSUBU(0x0f3d0192, 0x16951ca0, 0xcdf83a4c, 0x0a49ef6c, 0x6d756730, 0xf910efa7)
    TEST_MSUBU(0x66e1ec79, 0xe3394a73, 0xf036f4b3, 0xca435c8f, 0x404d305e, 0x9d86c897)
    TEST_MSUBU(0xd6928f57, 0x2f15f480, 0xbb11bc8c, 0xd9d6bb55, 0x5a63b904, 0x88485cbb)
    TEST_MSUBU(0x249bacc6, 0x10b6d676, 0xe68abf50, 0x256366eb, 0xc16ba8d4, 0xe0b84e26)
    TEST_MSUBU(0x729280f9, 0xbe6ea5f9, 0x38a06243, 0x99f2b48a, 0xdcbbdb13, 0x332cb6ad)
    TEST_MSUBU(0xff55afd2, 0x2d5961eb, 0x7b017320, 0x1d7971d9, 0xf31d41a6, 0x1f11b1ed)
    TEST_MSUBU(0xdaaf4e8e, 0xd79c5fed, 0x6d220fa3, 0x37aac108, 0x24e20b5e, 0xa073b37a)
    TEST_MSUBU(0x5154cd83, 0xd0cbe706, 0x6acf108e, 0x36b30a21, 0x71ae57c4, 0x2b834e1e)
###score ++
    addiu s3, s3, 1
###output (s0<<24)|s3
inst_error:  
    sll t1, s0, 24
    or t0, t1, s3 
    sw t0, 0(s1)
    jr ra
    nop
END(msubu_test)
