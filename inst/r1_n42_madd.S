#include <asm.h>
#include <regdef.h>

#define TEST_MADD(in_a, in_b, in_c, in_d, ref_lo, ref_hi) \
    li t0, in_a; \
    li t1, in_b; \
    li a0, in_c; \
    li a1, in_d; \
    mult t0, t1; \
    madd a0, a1; \
    mflo v1; \
    li v0, ref_lo; \
    bne v0, v1, inst_error; \
    nop; \
    mfhi v1; \
    li v0, ref_hi; \
    bne v0, v1, inst_error; \
    nop

LEAF(madd_test)
    .set noreorder
    addiu s0, s0, 1
###test inst
    TEST_MADD(0x44fe8826, 0xb9a8c52e, 0x6365e9b8, 0xcd3b1030, 0x4a910754, 0xd95485a1)
    TEST_MADD(0x05ba3376, 0x7de0a0fe, 0xf4b858cf, 0xc8b8205c, 0x3e4a9978, 0x0540814d)
    TEST_MADD(0x56b63d82, 0x597c5b7b, 0xc3328dc6, 0x3a478ae7, 0xff596d20, 0x1077f0ca)
    TEST_MADD(0x6d7eb0f1, 0x0a751966, 0x268e9ac3, 0x9c822e81, 0xc0980f49, 0xf57cefa4)
    TEST_MADD(0x329f0d9d, 0x9bcdd356, 0x46222212, 0x68eef037, 0x1d622b9c, 0x08ef462b)
    TEST_MADD(0x798efbef, 0x92b82835, 0x6f853900, 0xb8dc2b5c, 0x5432fc7b, 0xad1e72f4)
    TEST_MADD(0x724e36c8, 0x59e00d17, 0x2744ed4d, 0xf2f20139, 0xd4df371d, 0x262095b1)
    TEST_MADD(0x3a19b848, 0x53781d9f, 0xeb4fb133, 0xfcecf2f6, 0xbcb419ba, 0x13313496)
    TEST_MADD(0xd4b9bd4d, 0xb6eb62bf, 0x9937d22c, 0xda463992, 0x14645f8b, 0x1b800a0b)
    TEST_MADD(0x76e86a32, 0x13b9062f, 0xe7f78279, 0xb74b4939, 0xae0e391f, 0x0ffc8b24)
    TEST_MADD(0x948fd83c, 0x5c7653a4, 0x195c501d, 0xf482b492, 0xbc9e0efa, 0xd80ea7eb)
    TEST_MADD(0xffaa7240, 0x9821e315, 0xbaa65e83, 0xb4b962d0, 0x96900fb0, 0x148719a9)
    TEST_MADD(0x932fd29b, 0x619869d0, 0x6cb4a5b3, 0x7e3c47b5, 0xe0e67d7f, 0x0c1ed88f)
    TEST_MADD(0x167f7d99, 0x5dc74e74, 0xc13ba98b, 0x93f01e2a, 0xb5f0a222, 0x22bc8df9)
    TEST_MADD(0xe1ee28e6, 0x794feb88, 0xc25a53ec, 0xf1ca23ea, 0x5f4cd5e8, 0xf52c35de)
    TEST_MADD(0x115be1f7, 0xf0bd69d1, 0x7609a581, 0xb3437c3e, 0x05505ae5, 0xdb9550eb)
    TEST_MADD(0x257816c0, 0x5c4346f4, 0xae5c2352, 0x27c8cb4d, 0x18b6d4aa, 0x00d10185)
    TEST_MADD(0xa214ae90, 0x943d745d, 0x1efc7718, 0xe5e8c3b7, 0xf3dd1478, 0x24604684)
    TEST_MADD(0x559d6bba, 0x3b21202a, 0xe7b41426, 0xa8fcd6ff, 0x94e4c25e, 0x1c0875cf)
    TEST_MADD(0x81c2931e, 0x2c041abf, 0x499366e9, 0x4a8328de, 0xe0b77570, 0xffb5b90e)
    TEST_MADD(0x44bff4b9, 0x5c175c7e, 0x66087b4c, 0x31e4a3d1, 0x5a29fc1a, 0x2c9e027a)
    TEST_MADD(0x361a8b91, 0x500563eb, 0x19458486, 0x8c882368, 0x6cb8598b, 0x05835fa0)
    TEST_MADD(0x0641f60b, 0x90f86baa, 0xcd7d85af, 0x50ed5450, 0x1e662efe, 0xed519d3c)
    TEST_MADD(0xc9227e66, 0x5468141d, 0xa6aac7bd, 0x7fb2215b, 0x3316a6bd, 0xc159935f)
    TEST_MADD(0xa700ce0e, 0x2c8d668b, 0x240824b9, 0x4bc3f049, 0xf9ea5e5b, 0xfb2cf1fd)
    TEST_MADD(0xba8ddbd9, 0xb64713b6, 0xcfda918f, 0x9e7d4fc2, 0xb2bad6a4, 0x26567972)
    TEST_MADD(0x32d5c537, 0x0478c1ec, 0xbfacbefe, 0x8589cef6, 0xb22631c8, 0x1fa8b178)
    TEST_MADD(0xfb6a9fb1, 0x3a5edc5c, 0xa7a745ca, 0x21d19e52, 0xad1c8650, 0xf348ae4e)
    TEST_MADD(0x62b03750, 0xf5488dff, 0xdaf8dd2c, 0x42813eca, 0x53995568, 0xf23fdd44)
    TEST_MADD(0x127ea98a, 0xe1f7e938, 0x1eed02ff, 0x188a59db, 0x926be755, 0x00cb816d)
###score ++
    addiu s3, s3, 1
###output (s0<<24)|s3
inst_error:  
    sll t1, s0, 24
    or t0, t1, s3 
    sw t0, 0(s1)
    jr ra
    nop
END(madd_test)
