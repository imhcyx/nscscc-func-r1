#include <asm.h>
#include <regdef.h>

#define TEST_MADDU(in_a, in_b, in_c, in_d, ref_lo, ref_hi) \
    li t0, in_a; \
    li t1, in_b; \
    li a0, in_c; \
    li a1, in_d; \
    multu t0, t1; \
    maddu a0, a1; \
    mflo v1; \
    li v0, ref_lo; \
    bne v0, v1, inst_error; \
    nop; \
    mfhi v1; \
    li v0, ref_hi; \
    bne v0, v1, inst_error; \
    nop

LEAF(maddu_test)
    .set noreorder
    addiu s0, s0, 1
###test inst
    TEST_MADDU(0x5500597f, 0x9110f21a, 0x1524157e, 0xca515639, 0x8ab241f4, 0x40e00398)
    TEST_MADDU(0xdf910e93, 0xff1ce598, 0x3ca3d32b, 0x1d4ba00c, 0x7d7fec4c, 0xe5bb32b7)
    TEST_MADDU(0xa754e26f, 0xb57cf9b1, 0x03bf0603, 0x529e87eb, 0x43129f80, 0x77d6363b)
    TEST_MADDU(0xe9bbbca3, 0xf3666778, 0x974754b9, 0x15b5ce38, 0x8c6c67e0, 0xeb0efc92)
    TEST_MADDU(0x4386aa59, 0xd5b0b846, 0x09d79232, 0x0ddb900e, 0xd23eab12, 0x38e60c4c)
    TEST_MADDU(0xe553cde6, 0x50c83c18, 0xb683af02, 0x9331ce52, 0xf230e034, 0xb14eaf70)
    TEST_MADDU(0x1924b802, 0x83a857c4, 0x7a11e001, 0x513db01c, 0xd727bfa4, 0x33ab64fc)
    TEST_MADDU(0x9b9217cd, 0xf3613507, 0x84934cc5, 0x987f350c, 0xdf2079d7, 0xe2e0154c)
    TEST_MADDU(0x03bf9538, 0xd2c038d6, 0x1c2d0e56, 0xd1b9bf77, 0x2d94d0ca, 0x1a2b3343)
    TEST_MADDU(0x914e22c7, 0xea0274dc, 0x1066bd2d, 0x38d39786, 0x65e99f92, 0x8876d87f)
    TEST_MADDU(0x3453d59f, 0xc4516b83, 0x7b83dca2, 0x3fe2dc57, 0x14edf86b, 0x46f3bc12)
    TEST_MADDU(0x1bc38f1e, 0x2d30acb4, 0xd30e1996, 0x05a07fe3, 0x153ae31a, 0x098a404d)
    TEST_MADDU(0xf3353b25, 0x146f4111, 0x1d297c53, 0x22ab789e, 0xb6eaf5af, 0x175ce57a)
    TEST_MADDU(0x80a45908, 0x8c35d327, 0x7bcf2f89, 0xecc07626, 0xb07d5c8e, 0xb8f5012b)
    TEST_MADDU(0x5d239ade, 0x35918078, 0xc41ebeab, 0x76324fc7, 0x240093fd, 0x6e0a05fa)
    TEST_MADDU(0xd6cca322, 0x10fea43b, 0x22acffa7, 0xaa30b2d9, 0x191e3365, 0x254fed77)
    TEST_MADDU(0xdb34d446, 0x1bac319e, 0xdd52c0fe, 0x96397b3d, 0xb4446fba, 0x9992336b)
    TEST_MADDU(0xb4efcd6e, 0x3919022c, 0x3da1d6ba, 0xef71347f, 0x6791792e, 0x62006a3c)
    TEST_MADDU(0x494c9f10, 0x8c597497, 0xa6d8ccee, 0xe5ddae4b, 0x0d18e02a, 0xbdffee14)
    TEST_MADDU(0xafa33ee5, 0xfd9ccfed, 0x622e67ac, 0x30f95a57, 0x030c1875, 0xc0c84083)
    TEST_MADDU(0xc665d81d, 0xcb893ea5, 0x8bf8d6e5, 0xe6cdb220, 0x88676751, 0x1bef2826)
    TEST_MADDU(0xe45c4ba9, 0x18f1aeda, 0x5d009c77, 0xa2b67597, 0xf196f91b, 0x515cea1e)
    TEST_MADDU(0x5f3534b5, 0xe7a535ba, 0xa78a6a25, 0x1f1efabe, 0xebf3adf8, 0x6a847d01)
    TEST_MADDU(0x3b268f44, 0x7662d2b3, 0x90fc5bd4, 0x41fd49da, 0x2f1d9b14, 0x40ba2206)
    TEST_MADDU(0x06ce1293, 0xba4e05b5, 0x5ed2b77e, 0xd395cf0b, 0x689cc559, 0x5352f701)
    TEST_MADDU(0x5f3d2c63, 0x7c65913c, 0xf1c8ffeb, 0x0855b3fe, 0x30efb65e, 0x3626a466)
    TEST_MADDU(0x46f12cfb, 0xc70c9dbf, 0xe2a60b99, 0x28d56794, 0x7440c1b9, 0x5b4fdaa7)
    TEST_MADDU(0x1c62853a, 0x8406e9d6, 0x867f1133, 0xbd6bfa2c, 0x78eceb40, 0x72281b2c)
    TEST_MADDU(0xdc09089f, 0xa4c4250e, 0x8c0bcd4f, 0x832e7860, 0x2a557952, 0xd561d652)
    TEST_MADDU(0x3ada4fe2, 0x9c66846d, 0x7dbbeb55, 0x0dd8d9ae, 0xcd1d8c00, 0x2ac1a686)
###score ++
    addiu s3, s3, 1
###output (s0<<24)|s3
inst_error:  
    sll t1, s0, 24
    or t0, t1, s3 
    sw t0, 0(s1)
    jr ra
    nop
END(maddu_test)
